version: 2.1

jobs:
  build:
    docker:
      - image: cimg/openjdk:17.0  # Dùng JDK 17
    working_directory: ~/repo

    steps:
      - checkout

      # Cài đặt Chrome & ChromeDriver
      - run:
          name: Install Chrome
          command: |
            sudo apt-get update
            sudo apt-get install -y wget unzip
            wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
            sudo apt install -y ./google-chrome-stable_current_amd64.deb

      - run:
          name: Install ChromeDriver
          command: |
            CHROME_VERSION=$(google-chrome --version | grep -oE "[0-9]+")
            DRIVER_VERSION=$(curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE")
            wget "https://chromedriver.storage.googleapis.com/$DRIVER_VERSION/chromedriver_linux64.zip"
            unzip chromedriver_linux64.zip
            sudo mv chromedriver /usr/local/bin/
            sudo chmod +x /usr/local/bin/chromedriver

      # Build dự án
      - run:
          name: Maven clean install
          command: mvn clean install -DskipTests=false

      # Chạy test → Nếu muốn chạy testng.xml
      - run:
          name: Run TestNG Tests
          command: mvn test -DsuiteXmlFile=testng.xml

workflows:
  version: 2
  build_and_test:
    jobs:
      - build
